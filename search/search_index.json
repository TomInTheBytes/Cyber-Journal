{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome my cyber journal!","text":""},{"location":"cheatsheets/","title":"Cheatsheets","text":"<p>Personal collection of cheatsheets with items that come up on a recurring basis. </p>"},{"location":"cheatsheets/splunk/","title":"Splunk Cheatsheet","text":"<p>This page is a personal collection of useful Splunk queries and tips for analyzing data.</p>"},{"location":"cheatsheets/splunk/#search-field-performance","title":"Search &amp; field performance","text":"<p>In Splunk you can search for a term in the raw data or related to a specific field. While searching for a specific field (when possible) intuitively feels faster, it is not necessarily the case.     </p> <ul> <li>Raw term search (<code>\"search_value\"</code>): Matches token anywhere in <code>_raw</code> via inverted index. Fast. May match unintended fields or text.</li> <li>Field search (<code>field=\"search_value\"</code>): Matches only parsed field values. Requires search-time extraction unless field is indexed. To check if field is indexed:<ol> <li><code>| tstats count where index=&lt;index&gt; by &lt;field&gt;</code> \u2014 if results, field is indexed.</li> <li>Field appears immediately in search app\u2019s selected fields without extractions.</li> </ol> </li> <li>Performance: Non-indexed fields are slower due to extraction overhead. Indexed fields use <code>tsidx</code> and match raw term speed or slightly faster.</li> <li>Use field search when: Precision is needed, avoid false positives, or downstream commands depend on that field.</li> <li>Use raw term search when: Maximum speed and broad matching are acceptable.</li> </ul> <p>Summarized by AI (GPT-5)</p>"},{"location":"cheatsheets/splunk/#querying-datamodels","title":"Querying datamodels","text":"<p>Datamodels can accelarate search queries in Splunk. They can also combine multiple indices. Available datamodels can be found under Settings -&gt; Data -&gt; Data Models. </p> <p>1. <code>tstats</code> Command</p> <ul> <li>Purpose: Optimized for querying accelerated data models. Directly accesses pre-computed summaries.</li> <li>Syntax: <pre><code>| tstats &lt;aggregation&gt; from datamodel=&lt;DataModelName&gt;.&lt;DataSetName&gt; where &lt;DataSetName&gt;.&lt;FieldName&gt;=&lt;Value&gt; by &lt;DataSetName&gt;.&lt;FieldName&gt;\n</code></pre></li> <li>Example: <pre><code>| tstats summariesonly=true count from datamodel=Network_Traffic.All_Traffic \nwhere All_Traffic.dest_port=443 \nby All_Traffic.src_ip, All_Traffic.dest_ip\n</code></pre></li> <li>Characteristics:<ul> <li>Performance: Superior for aggregations on large, accelerated data.</li> <li>Limitations: Restricted to fields defined in data model acceleration; limited pre-aggregation transformations.</li> <li>Filtering: Uses <code>where</code> clause.</li> </ul> </li> </ul> <p>2. <code>| datamodel</code> Pipe Command</p> <ul> <li>Purpose: General command for retrieving events from any data model (accelerated or unaccelerated). Processes raw events.</li> <li> <p>Syntax: <pre><code>| datamodel &lt;DataModelName&gt; &lt;DataSetName&gt; | search &lt;FieldName&gt;=&lt;Value&gt; | &lt;other commands&gt;\n</code></pre></p> </li> <li> <p>Example: <pre><code>| datamodel Web_Traffic HTTP_Requests\n| search status=404 AND clientip!=\"10.0.0.0/8\"\n| eval request_size_kb = bytes / 1024\n| stats count as NotFoundCount, sum(request_size_kb) as TotalKBDelivered by url\n| sort - NotFoundCount\n| head 10\n</code></pre></p> </li> <li>Characteristics:<ul> <li>Flexibility: Allows complex initial filtering, <code>eval</code>, <code>rex</code>, and other transformations before aggregation.</li> <li>Performance: Can be slower than <code>tstats</code> for large, accelerated datasets due to raw event processing.</li> <li>Filtering: Uses standard <code>search</code> command.</li> </ul> </li> </ul> <p>Usage:</p> <ul> <li>Use <code>tstats</code>: For rapid aggregations on large, accelerated data models with straightforward filtering.</li> <li>Use <code>| datamodel</code>: For flexible event retrieval, pre-aggregation transformations, or unaccelerated data models.</li> </ul> <p>Summarized by AI (Gemini 2.5 Flash)</p>"},{"location":"projects/","title":"Overview","text":""},{"location":"projects/genai/intel_digest_workflow/","title":"Automation Workflow: Create Daily Digest &amp; Identify Viral Topics with AI","text":"<p>This page showcases an automation workflow built for the tool n8n. This n8n workflow template simplifies the process of digesting cybersecurity reports by summarizing, deduplicating, organizing, and identifying viral topics of interest into daily emails.</p> <p>Info</p> <p>The workflow was submitted to n8n for review and is available as template. A JSON copy can also be downloaded the repository this information is hosted on under the 'projects' folder.</p> <p></p> <p>The template was published on the n8n website and can be found here. </p>"},{"location":"projects/genai/intel_digest_workflow/#workflow-ai-threat-intelligence-compose-daily-digest-viral-topics-reports","title":"Workflow - AI Threat Intelligence: Compose Daily Digest &amp; Viral Topics Reports","text":"<p>Process cybersecurity reports into an AI-generated daily threat intelligence digest and viral topic report.</p> <p></p> <p>A n8n automation workflow for composing daily threat intelligence digest &amp; viral topics reports with AI.</p> <p>This n8n workflow simplifies the process of digesting cybersecurity reports by summarizing, deduplicating, organizing, and identifying viral topics of interest into daily emails. </p> <p>It will generate two types of emails: - A daily digest with summaries of deduplicated cybersecurity reports organized into various topics. - A daily viral topic report with summaries of recurring topics that have been identified over the last seven days. </p> <p>This workflow template supports threat intelligence analysts digest the high number of cybersecurity reports they must analyse daily by decreasing the noise and tracking topics of importance with additional care, while providing customizability with regards to sources and output format.</p>"},{"location":"projects/genai/intel_digest_workflow/#how-it-works","title":"How it works","text":"<p>The workflow follows the threat intelligence lifecycle as labelled by the coloured notes. - Every morning, collect news articles from a set of RSS feeds. - Merge the feeds output and prepare them for LLM consumption. - Task an LLM with writing an intelligence briefing that summarizes, deduplicates, and organizes the topics. - Generate and send an email with the daily digest. - Collect the daily digests of the last seven days and prepare them for LLM consumption. - Task an LLM with writing a report that covers 'viral' topics that have appeared prominently in the news.  - Store this report and send out over email.</p>"},{"location":"projects/genai/intel_digest_workflow/#how-to-use-customization","title":"How to use &amp; customization","text":"<ul> <li>The workflow will trigger daily at 7am. </li> <li>The workflow can be reused for other types of news as well. The RSS feeds can be swapped out and the AI prompts can easily be altered. </li> <li>The parameters used for the viral topic identification process can easily be changed (number of previous days considered, requirements for a topic to be 'viral').</li> </ul>"},{"location":"projects/genai/intel_digest_workflow/#requirements","title":"Requirements","text":"<ul> <li>The workflow leverages Gemini (free tier) for email content generation and Baserow for storing generated reports. The viral topic identification relies on the Gemini Pro model because of a higher data quantity and more complex task.</li> <li>An SMTP email account must be provided to send the emails with. This can be through Gmail. </li> </ul>"},{"location":"projects/genai/intel_rag/","title":"Generative AI threat intelligence research into automated threat actor assessment","text":"<p>This project (see repository) explores proof-of-concepts to integrate generative AI with threat intelligence. It is heavily inspired by the excellent research of Roberto Rodriguez (@Cyb3rWard0g). It follows a similar structure with small alterations. It contains various Jupyter Notebooks that explore the different topics. Every notebook is documented and has various improvement ideas. It explores the following areas:</p> <ul> <li>Threat Actor RAG: Building a retrieval-augmented generation (RAG) system using unstructured sources such as the ETDA Cyber Threat Actor Encyclopedia. </li> <li>Report Summarizer: Normalizing reports on threat actors by generating concise summaries for further usage by GenAI.</li> <li>Threat Actor Assessment: Automating evaluations of threat actors\u2019 relevance and risk to organizations using generative models and the threat box framework, aiming for consistency and reduced manual effort.</li> </ul>"},{"location":"projects/genai/intel_rag/#threat-actor-rag","title":"Threat Actor RAG","text":"<p>Retrieval Augmented Generation (RAG) is a method to retrieve context relevant for a chatbot prompt from a vector database. This way you can build a knowledge base and not be dependant on the LLMs context coverage and timeliness. You also have influence on what information the chatbot should work with and can prevent hallucinations. For more information see this great summary.</p> <p>@Cyb3rWard0g already experimented with using MITRE's threat actor database as knowledge for a RAG. This database contains very structured and consistent documents. I was curious to see how other, less controlled threat actor information sources would perform. I decided to do a simple scrape of the ETDA Threat Actor Encyclopedia. This database contains over 450 threat actors and provides various hyperlinks to reports about operations and information about these threat actors. See \"threat-actor-knowledge-builder.ipynb\" and \"threat-actor-QA.ipynb\" for the experiment.</p>"},{"location":"projects/genai/intel_rag/#report-summarizer","title":"Report Summarizer","text":"<p>The scraped reports vary in quality, length, and consistency. By summarizing them through an LLM we can iron out some of these issues. The summaries can also provide additional input for multi vector retrievers. This notebook describes how to loop over the reports and create summaries for reports where we can. It leverages OpenAI's API and deals with token limits.</p>"},{"location":"projects/genai/intel_rag/#threat-actor-assessment","title":"Threat Actor Assessment","text":"<p>As an organization you want to prioritize your resources through threat intelligence. By assessing threat actors for their threat level to your organization you can look at their TTPs to learn and prepare for. However, threat actor assessment can take a lot of effort through manual work, especially when kept up to date. It is also difficult to be consistent on the analysis through time and different analysts. Generative AI could support this process by assessing reports through some model. By leveraging the threat box model this notebook experiments with assessing threat actors through LLMs.</p>"},{"location":"projects/security_lab/","title":"Overview","text":""},{"location":"writeups/","title":"Overview","text":"<p>I occassionally participate in a capture the flag (CTF) events. I attempt to create write-ups for these to formally store the knowledge and support others looking for answers. </p>"},{"location":"writeups/hhc/","title":"SANS Holiday Hack Challenge","text":"<p>The SANS training institute organizes an annual CTF during the winter holiday season. It is free of charge and played in form of an online multiplayer rpg-like game including a world to walk around freely where you can meet your peers, NPCs with dialogue, and a storyline, making it a unique CTF.</p> <p>I have completed this CTF on multiple occassions. For some of them, I have created a write-up.</p> <ul> <li>2022: completed but no writeup available.</li> <li>2024: complete write-up. My submission was selected as 'super-honorable mention' by SANS.</li> </ul>"},{"location":"writeups/splunk_bots/","title":"Splunk Boss of the SOC (BOTS)","text":""},{"location":"writeups/splunk_bots/#introduction","title":"Introduction","text":"<p>Splunk Boss of the SOC (BOTS) was a competitive, capture-the-flag\u2013style event focused on security operations center skills. Participants investigate simulated security incidents using Splunk data to identify threats, analyze attacks, and answer challenge questions. It is designed to test threat detection, incident response, and data analysis capabilities in realistic, hands-on scenarios.</p> <p>Since most CTFs have an offensive focus, Splunk BOTS is a refreshing alternative. They were organized through 2016 until 2019 (four editions). They still host various challenges on their website, including the first edition. Edition two and three can be found on GitHub. </p> <p>I first learned about Splunk BOTS during a FIRST Technical Colloquium talk given by ex-employees and decided to give it a go myself. </p> <p>Info</p> <p>The answers should adhere to Splunk tips and tricks as listed on my Splunk cheatsheet. </p>"},{"location":"writeups/splunk_bots/#bots-v1-2015","title":"BOTS V1 (2015)","text":"<p>An overview of data sourcetypes and download link for the dataset can be found on GitHub. </p>"},{"location":"writeups/splunk_bots/#scenario-1-web-site-defacement","title":"Scenario 1: Web site defacement","text":"<p>Context</p> <p>Today is Alice's first day at the Wayne Enterprises' Security Operations Center. Lucius sits Alice down and gives her first assignment: A memo from Gotham City Police Department (GCPD). Apparently GCPD has found evidence online (http://pastebin.com/Gw6dWjS9) that the website www.imreallynotbatman.com hosted on Wayne Enterprises' IP address space has been compromised. The group has multiple objectives... but a key aspect of their modus operandi is to deface websites in order to embarrass their victim. Lucius has asked Alice to determine if www.imreallynotbatman.com. (the personal blog of Wayne Corporations CEO) was really compromised.</p> Question 101 <p>Question</p> <p>What is the likely IPv4 address of someone from the Po1s0n1vy group scanning imreallynotbatman.com for web application vulnerabilities?</p> Query<pre><code>index=botsv1 sourcetype=\"stream:http\" \"imreallynotbatman.com\"\n</code></pre> <p>Look for the domain as raw term in the HTTP logs. Using the sidebar we can see that only two source IPs are present in the results. We can quickly identify that one IP is sending suspicious requests: 40.80.148.42. </p> Question 102 <p>Question</p> <p>What company created the web vulnerability scanner used by Po1s0n1vy? Type the company name.</p> Query<pre><code>index=botsv1 sourcetype=\"stream:http\" src_ip=\"40.80.148.42\" \"imreallynotbatman.com\"\n</code></pre> <p>Look at HTTP requests coming from the malicious IP address. In the headers of the requests (<code>src_headers</code>) we find the product: Acunetix-Product: WVS/10.0 (Acunetix Web Vulnerability Scanner - Free Edition). </p> Question 103 <p>Question</p> <p>What content management system is imreallynotbatman.com likely using?</p> <p>Using the same query as that for question 102 we can see that many of the URIs attacked contain <code>/joomla/</code>. A Google search reveals that this is a CMS and therefore the answer: joomla. </p> Question 104 <p>Question</p> <p>What is the name of the file that defaced the imreallynotbatman.com website? Please submit only the name of the file with extension?</p> Query<pre><code>index=botsv1 sourcetype=\"fgt_utm\" src=\"192.168.250.70\" \n</code></pre> <p>The FortiGate firewalls have the unified threat management (UTM) feature enabled. This index will contain incoming and outgoing analyzed traffic (WAF/IDS-like). We look for events coming from the webserver itself as the attacker likely compromised it before defacing it and pulled the image from somewhere else. We find the webserver IP using the query in question 102. The answer we find is: poisonivy-is-coming-for-you-batman.jpeg. </p> Question 105 <p>Question</p> <p>This attack used dynamic DNS to resolve to the malicious IP. What fully qualified domain name (FQDN) is associated with this attack?</p> <p>Using the same event that provided we answer for 104 we find: prankglassinebracket.jumpingcrab.com. </p> Question 106 <p>Question</p> <p>What IPv4 address has Po1s0n1vy tied to domains that are pre-staged to attack Wayne Enterprises?</p> <p>Using the same event that provided we answer for 104 and 105 we find: 23.22.63.114. </p> Question 108 <p>Question</p> <p>What IPv4 address is likely attempting a brute force password attack against imreallynotbatman.com?</p> Query<pre><code>index=botsv1 sourcetype=\"stream:http\" dest_ip=\"192.168.250.70\" http_method=POST src_ip=\"23.22.63.114\"\n</code></pre> <p>From question 101 we know that there are two IPs connecting to the webserver, of which one is a vulnerability scanner. While the attacker could conduct a brute-force attack from this IP, we see the brute-force attempts when analyzing traffing from the other one ('src_content'). Therefore, the answer is: 23.22.63.114.</p> Question 109 <p>Question</p> <p>What is the name of the executable uploaded by Po1s0n1vy? </p> Query<pre><code>index=botsv1 sourcetype=\"stream:http\" dest_ip=\"192.168.250.70\" http_method=POST \"upload\" \".exe\"\n</code></pre> <p>Build a query that looks for HTTP traffic with the webserver as destination IP, HTTP method POST, and containing references to uploading and Windows executables. This returns a single event regarding an upload. This executable appears to be: 3791.exe. </p> Question 110 <p>Question</p> <p>What is the MD5 hash of the executable uploaded?</p> Query<pre><code>index=botsv1 sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=1 process=\"3791.exe\" \"3791.exe\"\n</code></pre> <p>Sysmon will have recorded this when the executable was launched (event code 1). Look for the executable using both a raw term search as it can appear in multiple fields and in the process field. This query is much quicker than when not supplying the raw term. The hash we find is: AAE3F5A29935E6ABCC2C2754D12A9AF0. </p> Question 111 <p>Question</p> <p>GCPD reported that common TTPs (Tactics, Techniques, Procedures) for the Po1s0n1vy APT group, if initial compromise fails, is to send a spear phishing email with custom malware attached to their intended target. This malware is usually connected to Po1s0n1vys initial attack infrastructure. Using research techniques, provide the SHA256 hash of this malware.</p> <p>We leverage VirusTotal to look for relationships of the attacker infrastructure 23.22.63.114. Under 'Communicating Files' there are four likely malicious files listed. One of them has an ominous looking name that could be used in a spearsphing attack called <code>MirandaTateScreensaver.src.exe</code>. The SHA256 hash of this file is: 9709473ab351387aab9e816eff3910b9f28a7a70202e250ed46dba8f820f34a8. </p> Question 112 <p>Question</p> <p>What special hex code is associated with the customized malware discussed in question 111?</p> <p>The VirusTotal page for the malware found in question 111 contains comments. The first comment from 'ryan_kovar' contains a hex string: 53 74 65 76 65 20 42 72 61 6e 74 27 73 20 42 65 61 72 64 20 69 73 20 61 20 70 6f 77 65 72 66 75 6c 20 74 68 69 6e 67 2e 20 46 69 6e 64 20 74 68 69 73 20 6d 65 73 73 61 67 65 20 61 6e 64 20 61 73 6b 20 68 69 6d 20 74 6f 20 62 75 79 20 79 6f 75 20 61 20 62 65 65 72 21 21 21 </p> <p>This translates to <code>Steve Brant's Beard is a powerful thing. Find this message and ask him to buy you a beer!!!</code>. </p> Question 114 <p>Question</p> <p>What was the first brute force password used?</p> Query<pre><code>index=botsv1 sourcetype=\"stream:http\" dest_ip=\"192.168.250.70\" http_method=POST src_ip=\"23.22.63.114\" | tail 1\n</code></pre> <p>Look for all brute-force attempts and filter out the first one. The password shown in <code>form_data</code> is: 12345678. </p> Question 115 <p>Question</p> <p>One of the passwords in the brute force attack is James Brodsky's favorite Coldplay song. We are looking for a six character word on this one. Which is it?</p> Query<pre><code>index=botsv1 sourcetype=\"stream:http\" dest_ip=\"192.168.250.70\" http_method=POST src_ip=\"23.22.63.114\" \n| rex field=src_content \"(?:^|&amp;)passwd=(?P&lt;password&gt;[^&amp;]+)\" \n| eval length=len(password) \n| table password, length \n| where length=6\n</code></pre> <p>Again look for all brute-force attempts and extract the password used from the <code>src_content</code> field using regex. We can filter on the field name <code>passwd</code> and take all characters until the next <code>&amp;</code> delimiter. We then compute the length of the password and create a table with only password with a length of six. Using some common Coldplay knowledge, we identify the password with the name of a Coldplay song: yellow.</p> AI usage <p>The regex was created with help of ChatGPT and summarized as follows:</p> <ol> <li> <p><code>(?:^|&amp;)</code> Non-capturing group. Matches either the beginning of the string (<code>^</code>) or an ampersand (<code>&amp;</code>). Ensures we only match when <code>passwd=</code> is a standalone parameter and not a substring inside another value.</p> </li> <li> <p><code>passwd=</code> Literal match for the field name.</p> </li> <li> <p><code>(?P&lt;password&gt;[^&amp;]+)</code> Named capturing group called <code>password</code>. Captures one or more characters (<code>+</code>) that are not an ampersand (<code>[^&amp;]</code>). This ensures the captured value ends before the next delimiter.</p> </li> </ol> Question 116 <p>Question</p> <p>What was the correct password for admin access to the content management system running \"imreallynotbatman.com\"?</p> Query<pre><code>index=botsv1 dest_ip=\"192.168.250.70\" sourcetype=\"stream:http\" http_method=POST form_data=\"*passwd*\" form_data=\"*username=admin*\" src_ip=\"40.80.148.42\"\n</code></pre> <p>The data from the brute-force IP does not show an obvious candidate. However, when swapping out the IP with the vulnerability scanner we find a single event with the correct password: batman. </p> Question 117 <p>Question</p> <p>What was the average password length used in the password brute forcing attempt?</p> Query<pre><code>index=botsv1 sourcetype=\"stream:http\" dest_ip=\"192.168.250.70\" http_method=POST src_ip=\"23.22.63.114\" \n| rex field=src_content \"(?:^|&amp;)passwd=(?P&lt;password&gt;[^&amp;]+)\" \n| eval length=len(password) \n| table password, length \n| stats avg(length)\n</code></pre> <p>We reuse the query used for question 115 and now compute the average length. This returns (rounded down): 6. </p> Question 118 <p>Question</p> <p>How many seconds elapsed between the time the brute force password scan identified the correct password and the compromised login? </p> Query<pre><code>index=botsv1 sourcetype=\"stream:http\" dest_ip=\"192.168.250.70\" http_method=POST form_data=\"*batman*\" \n| sort _time \n| streamstats current=f last(_time) as prev_time \n| eval diff_seconds=_time - prev_time\n</code></pre> <p>We look for requests containing the password <code>batman</code>. The query returns two events; the brute-force attempt and the actual login. We can compute the time in seconds as <code>diff_seconds</code> between these two events: 92.17. </p> AI usage <p>ChatGPT came up with the computation of the difference in time directly in the query using <code>streamstats</code>, which it explained as follows:</p> <p><code>streamstats</code> processes events as they stream in, maintaining state across rows.</p> <ul> <li><code>current=f</code> prevents including the current row in the calculation, so only past rows are referenced.</li> <li><code>last(_time) as prev_time</code> stores the previous event\u2019s <code>_time</code> value in a new field <code>prev_time</code>.</li> <li>Each event gets paired with the immediately preceding event\u2019s time, enabling <code>eval</code> to compute their difference.</li> </ul> Question 119 <p>Question</p> <p>How many unique passwords were attempted in the brute force attempt?</p> Query<pre><code>index=botsv1 sourcetype=\"stream:http\" dest_ip=\"192.168.250.70\" http_method=POST src_ip=\"23.22.63.114\" \n| rex field=src_content \"(?:^|&amp;)passwd=(?P&lt;password&gt;[^&amp;]+)\" \n| stats values(password)\n</code></pre> <p>We again reuse the query and compute all the unique passwords: 412.  </p>"},{"location":"writeups/splunk_bots/#scenario-2-ransomware","title":"Scenario 2: Ransomware","text":"<p>Context</p> <p>After the excitement of yesterday, Alice has started to settle into her new job. Sadly, she realizes her new colleagues may not be the crack cybersecurity team that she was led to believe before she joined. Looking through her incident ticketing queue she notices a \u201ccritical\u201d ticket that was never addressed. Shaking her head, she begins to investigate. Apparently on August 24th Bob Smith (using a Windows 10 workstation named we8105desk) came back to his desk after working-out and found his speakers blaring (click below to listen), his desktop image changed (see below) and his files inaccessible.</p> <p>Alice has seen this before... ransomware. After a quick conversation with Bob, Alice determines that Bob found a USB drive in the parking lot earlier in the day, plugged it into his desktop, and opened up a word document on the USB drive called \"Miranda_Tate_unveiled.dotm\". With a resigned sigh she begins to dig into the problem...</p> Question 200 <p>Question</p> <p>What was the most likely IPv4 address of we8105desk on 24AUG2016? </p> Query<pre><code>index=\"botsv1\" host=\"we8105desk\"\n</code></pre> <p>Filter for the hostname using the indexed field and look for the most frequent source IP in the sidebar. This will be: 192.168.250.100.</p> Question 201 <p>Question</p> <p>Amongst the Suricata signatures that detected the Cerber malware, which one alerted the fewest number of times? Submit ONLY the signature ID value as the answer.</p> Query<pre><code>index=\"botsv1\" sourcetype=\"suricata\" src_ip=\"192.168.250.100\" \"Cerber\"\n</code></pre> <p>Filter for logs generated by suricata containing the IP mentioned in the last question, and containing the malware name (this query could be optimized by searching in specific fields). Use the sidebar to locate the ID, which will be: 2816763. </p> Question 202 <p>Question</p> <p>What fully qualified domain name (FQDN) does the Cerber ransomware attempt to direct the user to at the end of its encryption phase?</p> <p>We can reuse the query on Suricata data of question 201 to get the time range we need to look for in DNS data. We run the query and click on the time field of the latest result. Splunk will then prompt to set a time range based on that time. We choose to set it to look for events 5 minutes before and after. We can then run this next query to summarize the DNS queries run from the workstation in that timeframe:</p> Query<pre><code>index=\"botsv1\" sourcetype=\"stream:dns\" src_ip=\"192.168.250.100\" | stats count by query\n</code></pre> <p>There are six unique DNS queries of which one is the obviously malicious one: cerberhhyed5frqa.xmfir0.win.</p> Question 203 <p>Question</p> <p>What was the first suspicious domain visited by we8105desk on 24AUG2016?</p> Query<pre><code>index=\"botsv1\" sourcetype=\"stream:dns\" src_ip=\"192.168.250.100\" earliest=\"08/24/2016:0:0:0\" latest=\"08/24/2016:23:59:59\" | reverse | table _time, query\n</code></pre> <p>Run a query on the DNS data with the correct time range. The IP address is searched with a raw term search as the <code>host_addr</code> field needed is an array and thus doesn't search easily. The query formats the output into a table that is sorted on ascending time. On page nine the suspicious domain is found: solidaritedeproximite.org.</p> Question 204 <p>Question</p> <p>During the initial Cerber infection a VB script is run. The entire script from this execution, pre-pended by the name of the launching .exe, can be found in a field in Splunk. What is the length of the value of this field?</p> Query<pre><code>index=\"botsv1\" sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" dvc_nt_host=\"we8105desk\" \".vbs\" | eval length=len(cmdline) | table _time, CommandLine,length | reverse\n</code></pre> <p>Sysmon data will include the VB script. Look for anything related to <code>.vbs</code> and compute the cmdline length. We then use a table to display the results in ascending order. Don't forget to reset the time range to all time after answering the questions before.</p> <p>We find ten different command lines. The first suspicious one has a length of: 4490.</p> Question 205 <p>Question</p> <p>What is the name of the USB key inserted by Bob Smith?</p> Query<pre><code>index=\"botsv1\" host=\"we8105desk\" sourcetype=\"winregistry\" \"usbstor\" | stats values(data)\n</code></pre> <p>The WinEvent logs provided (<code>application</code>, <code>security</code>, and <code>system</code> as per the GitHub repository) lack the needed <code>operational</code> channel to look for USB events. We do have the winregistry events at our disposal. USB devices are added to the <code>USBSTOR</code> in the registry. We look for this term and look at the unique data values that are being set. The query returns many typical Windows registry terms and IDs except a suspicious name: MIRANDA_PRI. </p> Question 206 <p>Question</p> <p>Bob Smith's workstation (we8105desk) was connected to a file server during the ransomware outbreak. What is the IPv4 address of the file server?</p> Query<pre><code>index=\"botsv1\" sourcetype=\"stream:smb\" src_ip=\"192.168.250.100\" | stats count by dest_ip\n</code></pre> <p>Look for SMB traffic coming from the workstation and identify the IP connected most often to: 192.168.250.20. </p> Question 207 <p>Question</p> <p>How many distinct PDFs did the ransomware encrypt on the remote file server? </p> Query<pre><code>index=\"botsv1\" sourcetype=\"WinEventLog:Security\" host=\"we9041srv\" Accesses=DELETE \".pdf\" | stats values(Relative_Target_Name)\n</code></pre> <p>We can identify the hostname of the file server (<code>we9041srv</code>) by reversing the trick used for question 200. Then look for deletion of PDF files and count the unique events: 257.</p> Question 208 <p>Question</p> <p>The VBscript found in question 204 launches 121214.tmp. What is the ParentProcessId of this initial launch?</p> Query<pre><code>index=\"botsv1\" sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" host=\"we8105desk\" EventCode=1 \"121214.tmp\" \".vbs\"\n</code></pre> <p>Look for process start events with both terms. We find the parent process ID is: 3968. </p> Question 209 <p>Question</p> <p>The Cerber ransomware encrypts files located in Bob Smith's Windows profile. How many .txt files does it encrypt?</p> Query<pre><code>index=\"botsv1\" host=\"we8105desk\" sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=2 TargetFilename=\"C:\\\\Users\\\\bob.smith.WAYNECORPINC\\\\*\" TargetFilename=\"*.txt\"\n</code></pre> <p>Count the Sysmon events that involve file creation with the target including the user profile and the file extension, resulting in the number of encrypted files: 406.</p> Question 210 <p>Question</p> <p>The malware downloads a file that contains the Cerber ransomware cryptor code. What is the name of that file? </p> Query<pre><code>index=\"botsv1\" sourcetype=\"suricata\" dest_ip=\"192.168.250.100\" | table fileinfo.filename, fileinfo.size | sort -fileinfo.size\n</code></pre> <p>Look for all file names and sizes with the infected workstation as destination. A ransomware executable will typically be larger than other files so we sort the results by size. The top result immediately stands out as it's a relatively large JPG file with a suspicious name: mhtr.jpg. </p> Question 211 <p>Question</p> <p>Now that you know the name of the ransomware's encryptor file, what obfuscation technique does it likely use?</p> <p>The technique to hide data in files such as images is typically called: steganography. </p>"}]}